(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["editor"],{"2b8d":function(e,t,i){},"5d58":function(e,t,i){e.exports=i("d8d6")},"67bb":function(e,t,i){e.exports=i("f921")},"8fc3":function(e,t,i){"use strict";var o=i("2b8d"),a=i.n(o);a.a},a857:function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-lx-calendar"}),e._v(" 课程管理\n            ")])],1)],1),i("div",{staticClass:"container"},[i("div",{staticClass:"handle-box display_flex between"},[i("div",{staticClass:"display_flex"}),i("div",[i("el-button",{attrs:{type:"primary"},on:{click:e.open}},[e._v("新增")])],1)]),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"multipleTable",staticClass:"table",attrs:{data:e.tableData,border:"","header-cell-class-name":"table-header"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{prop:"name",label:"课名称"}}),i("el-table-column",{attrs:{label:"课程节次",prop:"lesson"}}),i("el-table-column",{attrs:{label:"课简介",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"less"},[e._v(e._s(t.row.note))])]}}])}),i("el-table-column",{attrs:{label:"课预览图",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("img",{staticStyle:{width:"100px",height:"100px","object-fit":"contain"},attrs:{src:t.row.preview},on:{click:function(i){return e.showPreview(t.row)}}})]}}])}),i("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary"},on:{click:function(i){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),i("el-button",{attrs:{type:"danger"},on:{click:function(i){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),i("el-dialog",{attrs:{title:"课程",visible:e.editVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.editVisible=t}}},[i("el-form",{ref:"form",attrs:{model:e.form,"label-width":"150px",rules:e.rules}},[i("div",{staticClass:"flex-row"},[i("el-form-item",{attrs:{label:"课名",prop:"name"}},[i("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"节次",prop:"lesson"}},[i("el-input",{attrs:{disabled:""},model:{value:e.form.lesson,callback:function(t){e.$set(e.form,"lesson",t)},expression:"form.lesson"}})],1)],1),i("div",{staticClass:"flex-row"},[i("el-form-item",{attrs:{label:"课简介",prop:"note"}},[i("el-input",{attrs:{type:"textarea",autosize:{minRows:9},resize:"none"},model:{value:e.form.note,callback:function(t){e.$set(e.form,"note",t)},expression:"form.note"}})],1),i("el-form-item",{attrs:{label:"课预览图",prop:"preview"}},[i("qiniuImg",{attrs:{address:e.form.preview},on:{back:e.getPreviewUrl}})],1)],1),i("el-form-item",{attrs:{label:"上传视频",prop:"videoAddress"}},[i("qiniu",{attrs:{close:!e.editVisible,address:e.form.videoAddress},on:{back:e.getVideoUrl}})],1),i("el-form-item",{attrs:{label:"视频时间",prop:"videoDuration"}},[i("el-input",{attrs:{disabled:!0},model:{value:e.form.videoDuration,callback:function(t){e.$set(e.form,"videoDuration",t)},expression:"form.videoDuration"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.editVisible=!1}}},[e._v("取 消")]),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:!e.isCheck,expression:"!isCheck"}],attrs:{type:"primary"},on:{click:function(t){return e.addClass("form")}}},[e._v("确 定")])],1)],1),i("el-dialog",{staticClass:"privew-dialog",attrs:{visible:e.imgShow,width:"100%","close-on-click-modal":!1},on:{"update:visible":function(t){e.imgShow=t}}},[i("img",{staticClass:"preview-img",attrs:{src:e.currentPreview,alt:""}})])],1)},a=[],s=(i("6b54"),i("5d58")),n=i.n(s),r=i("67bb"),l=i.n(r);function c(e){return c="function"===typeof l.a&&"symbol"===typeof n.a?function(e){return typeof e}:function(e){return e&&"function"===typeof l.a&&e.constructor===l.a&&e!==l.a.prototype?"symbol":typeof e},c(e)}function u(e){return u="function"===typeof l.a&&"symbol"===c(n.a)?function(e){return c(e)}:function(e){return e&&"function"===typeof l.a&&e.constructor===l.a&&e!==l.a.prototype?"symbol":c(e)},u(e)}i("7f7f"),i("28a5");var d=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",[i("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"",limit:1,"http-request":e.selectVideo}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),e.show?i("div",{staticClass:"mt-top"},[i("el-progress",{attrs:{"stroke-width":5,percentage:e.percentage}})],1):e._e(),i("div",{staticClass:"mt-top",attrs:{id:"preview"}})])},m=[],f=i("cea2"),p={name:"qiniu",data:function(){return{percentage:0,show:!1,player:"",url:"",key:""}},props:{address:{type:String,value:""},close:{type:Boolean,value:!1}},watch:{address:{handler:function(e){e&&(this.key=e,this.getVideoUrl(this.key))},immediate:!0},close:{handler:function(e){e?(this.player&&(this.player.destroy(),this.player="",this.url="",this.key=""),this.$refs.upload.clearFiles(),this.$emit("close")):this.createVideo()}}},mounted:function(){},methods:{createVideo:function(e){var t=this;this.player&&this.player.destroy(),this.player=new QPlayer({url:this.url,container:document.getElementById("preview")}),this.player.on("ready",(function(){t.$refs.upload.clearFiles(),t.$emit("back",t.url,t.player.totalTime,e),console.log(t.player.totalTime,"time")}))},selectVideo:function(e){var t=e.file,i=t.name.split("."),o=(new Date).getTime()+"."+i[i.length-1],a={fname:t.name,params:{type:"course_catalog",typeId:""},mimeType:["video/mp4"]},s={useCdnDomain:!0,region:null},n=this,r={next:function(e){n.show=!0,n.percentage=Math.floor(e.total.percent),100==n.percentage&&(n.show=!1,n.getVideoUrl(o)),console.log(e)},error:function(e){console.log(e)}};this.axios.get("/universal/upload").then((function(e){var i=e.data,n=f["upload"](t,o,i,a,s);n.subscribe(r)}))},getVideoUrl:function(e){var t=this;this.axios.get("/universal/getFileUrl",{params:{key:e}}).then((function(i){t.url=i.data,t.createVideo(e)}))}}},h=p,g=(i("d96b"),i("2877")),v=Object(g["a"])(h,d,m,!1,null,"6e2f29d6",null),b=v.exports,y=i("f454"),w={components:{qiniu:b,qiniuImg:y["default"]},data:function(){return{rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],lesson:[{required:!0,message:"请输入节次",trigger:"blur"}],note:[{required:!0,message:"请输入简介",trigger:"blur"}],preview:[{required:!0,message:"请输入预览图",trigger:"blur"}],videoAddress:[{required:!0,message:"请上传视频",trigger:"blur"}],videoDuration:[{required:!0,message:"请输入视频时间",trigger:"blur"}]},imgShow:!1,currentPreview:"",query:{},form:{courseCatalogId:"",courseId:"",name:"",lesson:0,note:"",preview:"",videoAddress:"",videoDuration:"",videoUrl:""},tableData:[],editVisible:!1,videoLoading:!1,imgLoading:!1,pageTotal:0,pageNum:1,id:-1,qiniuFile:"",qiniuNowFile:"",qiniuType:"",qiniuName:"",tableLoading:!1,isCheck:!0}},watch:{editVisible:function(e){e||this.clearForm()}},created:function(){this.id=this.$route.query.id;var e=JSON.parse(JSON.stringify(this.form));e.courseId=this.$route.query.id,this.form=e,this.getData({courseId:this.id})},methods:{showPreview:function(e){this.currentPreview=e.preview,this.imgShow=!0},getPreviewUrl:function(e){var t=JSON.parse(JSON.stringify(this.form));t.preview=e,this.form=t},getVideoUrl:function(e,t,i){console.log(i);var o=JSON.parse(JSON.stringify(this.form));o.videoUrl=e,o.videoDuration=t,o.videoAddress=i,this.form=o},selectVideo:function(e){var t=this;console.log(e);var i=e.target.files[0],o=i.name.split(".");this.qiniuNowFile=i,this.qiniuType=o[o.length-1],this.qiniuName=i.name;var a=new FileReader,s=(a.readAsDataURL(i),"");a.onload=function(e){console.log("---"),s="object"===u(e.target.result)?new Blob([e.target.result]):e.target.result,t.qiniuFile=s,console.log(s.toString())}},uploadVideo:function(){var e=this;this.videoLoading=!0;var t=(new Date).getTime()+"."+this.qiniuType,i={fname:this.qiniuName,params:{type:"course_catalog",typeId:""},mimeType:["video/mp4"]},o={useCdnDomain:!0,region:null},a={next:function(e){console.log(e.percent)},error:function(e){console.log(e)}};this.axios.get("/universal/upload").then((function(s){var n=s.data,r=b.upload(e.qiniuNowFile,t,n,i,o);r.subscribe(a)}))},publish:function(e,t){var i=this;console.log(t),0==t.publish?this.$confirm("确定要发布吗？","提示",{type:"warning"}).then((function(){var e={courseId:t.courseId,publish:1};i.axios.get("/manager/courseManagement/publishCourse",{params:e}).then((function(e){i.$message.success("发布成功"),i.getData({pageNum:i.pageNum,pageSize:10})}))})).catch((function(){})):this.$confirm("确定要下架吗？","提示",{type:"warning"}).then((function(){var e={courseId:t.courseId,publish:0};i.axios.get("/manager/courseManagement/publishCourse",{params:e}).then((function(e){i.$message.success("下架成功"),i.getData({pageNum:i.pageNum,pageSize:10})}))})).catch((function(){}))},getData:function(e){var t=this,i=JSON.parse(JSON.stringify(this.form)),o=this;this.tableLoading=!0,this.axios.get("/manager/courseManagement/obtainCourseCatalog",{params:e}).then((function(e){t.tableData=e.data,t.tableLoading=!1,i.lesson=e.data.length+1,o.form=i,t.clearForm(),console.log(o.form,"lllll")}))},handleSearch:function(){var e=this.query;e.courseId=this.id,this.getData(e)},handleDelete:function(e,t){var i=this;this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){var e={courseCatalogId:t.id};i.axios.get("/manager/courseManagement/deleteCourseCatalog",{params:e}).then((function(e){i.$message.success("删除成功"),i.getData({courseId:i.id})}))})).catch((function(){}))},handleSelectionChange:function(e){this.multipleSelection=e},delAllSelection:function(){var e=this.multipleSelection.length,t="";this.delList=this.delList.concat(this.multipleSelection);for(var i=0;i<e;i++)t+=this.multipleSelection[i].name+" ";this.$message.error("删除了".concat(t)),this.multipleSelection=[]},handleEdit:function(e,t){var i={courseCatalogId:t.id,name:t.name,lesson:t.lesson,preview:t.preview,note:t.note,courseId:t.courseId,videoAddress:t.videoAddress,videoDuration:t.videoDuration};this.form=i,this.editVisible=!0,console.log(this.form)},clearForm:function(){var e=JSON.parse(JSON.stringify(this.form));this.form={courseCatalogId:0,name:"",lesson:this.tableData.length+1,note:"",preview:"",courseId:e.courseId,videoAddress:"",effectiveTime:""}},open:function(e){var t=JSON.parse(JSON.stringify(this.form));this.form={courseCatalogId:0,name:"",lesson:this.tableData.length+1,note:"",preview:"",courseId:t.courseId,videoAddress:"",effectiveTime:""},this.editVisible=!0},addClass:function(e){var t=this;if(this.isCheck){JSON.parse(JSON.stringify(this.form));this.videoAddress||this.imgLoading?this.$message.error("正在上传"):(this.isCheck=!1,this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),setTimeout((function(){t.isCheck=!0}),500),!1;console.log(t.form),t.axios.post("/manager/courseManagement/insertCourseCatalog",t.form).then((function(e){t.$message.success(t.form.courseCatalogId?"更新成功":"新增成功"),t.editVisible=!1,t.getData({courseId:t.id}),setTimeout((function(){t.isCheck=!0}),500)})).catch((function(e){setTimeout((function(){t.isCheck=!0}),500)}))})))}},handlePageChange:function(e){console.log(e),this.getData({pageNum:e,pageSize:10})}}},C=w,S=(i("8fc3"),Object(g["a"])(C,o,a,!1,null,"67980475",null));t["default"]=S.exports},af9f:function(e,t,i){},d96b:function(e,t,i){"use strict";var o=i("af9f"),a=i.n(o);a.a}}]);